# v3 WebSocket 실시간 모델 (핵심 개념)

## 40개 슬롯의 정확한 의미

**❌ 잘못된 이해**: 1초에 40개 종목 조회 가능
**✅ 올바른 이해**: 동시에 40개 종목을 구독하여 실시간 수신 가능

## WebSocket vs REST API

### REST API (Polling 방식)
```
매초마다 반복:
- 종목 A 현재가 조회 (API 호출 1회)
- 종목 B 현재가 조회 (API 호출 1회)
- ...
- 종목 Z 현재가 조회 (API 호출 1회)

문제: 2000개 조회 = 2000번 API 호출 필요 → 불가능
```

### WebSocket (Subscription 방식)
```
최초 1회 구독:
- 종목 A 구독 신청
- 종목 B 구독 신청
- ...
- 종목 Z 구독 신청 (최대 40개)

이후 자동 수신:
- 체결 발생 시마다 서버가 자동 push
- 초당 수천 건 수신 가능
- 추가 API 호출 불필요
```

## 실제 데이터 흐름 (1초 동안)

```
삼성전자 (활발):
├─ 09:05:00.123 - 78,000원 체결 (즉시 수신)
├─ 09:05:00.456 - 78,100원 체결 (즉시 수신)
├─ 09:05:00.789 - 78,200원 체결 (즉시 수신)
└─ 1초에 100~150건 수신

소형주 (조용):
└─ 09:05:00.234 - 5,000원 체결 (1분에 3~4건만 수신)

40개 전체:
└─ 1초에 총 2,000~3,000건 수신 가능
```

## v3의 40개 슬롯 활용

```
Priority 1: 보유종목 (10개) - 절대 제거 안함
Priority 2: AI Daily Picks (20개) - 매일 07:20 갱신
Priority 3: 급등주 (10개) - 동적 추가/제거

총 40개:
- 한 번 구독 후 계속 수신
- 슬롯 부족 시 Priority 3부터 제거
- 실시간 체결/호가 동시 모니터링
```

## 핵심 장점

1. **진짜 실시간**: 체결 즉시 수신 (지연 0.1초 이내)
2. **무제한 수신**: 초당 수천 건 처리 가능
3. **효율성**: API 호출 최소화
4. **동시 모니터링**: 40개 종목 동시에 추적

## 제한 이유

KIS 서버 부하 관리:
- 사용자 1명 = 40개 스트림
- 10,000명 = 400,000개 스트림 (관리 가능)
- 무제한 시 = 20,000,000개 스트림 (서버 과부하)
