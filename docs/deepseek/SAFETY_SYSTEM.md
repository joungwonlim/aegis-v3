# AEGIS v3.1 안전 시스템 문서

## 개요
AEGIS(Automated Execution Guard & Intervention System) v3.1은 자동화된 알고리즘 트레이딩 시스템의 안전을 보장하는 다중 레이어 안전장치입니다. 한국전력 사태를 포함한 실제 시장 사례의 교훈을 반영하여 설계되었으며, 자동화된 대응 프로세스와 실시간 모니터링을 통해 시스템 리스크를 관리합니다.

---

## 1. 핵심 설계 원칙

### 1.1 방어적 다중 레이어 접근법
- **중복 검증**: 각 레이어는 독립적이며 중복된 검증 수행
- **에스컬레이션**: 위험 수준에 따라 점진적 대응 적용
- **자동 회복**: 정상 상태로의 자동 복구 절차 내장

### 1.2 한국전력 사태 교훈 반영

사례: 2023년 한국전력 변동성 급등 사태
문제점:
1. 유동성 급감 시 Stop-Loss 집중 실행
2. 관련 섹터 전반의 동시 하락
3. 시스템 과부하로 인한 지연 응답

교훈 반영:
- 섹터 리스크 집중도 모니터링 강화
- 유동성 기반 주문 실행 로직 추가
- 서킷브레이커 확장 적용


---

## 2. 4단계 레이어 구조

### 2.1 Layer 1: 거래 검증기 (Trade Validator)
**목적**: 모든 주문 실행 전 사전 검증

| 검증 항목 | 임계값 | 조치 |
|---------|-------|------|
| 단일 종목 노출도 | 총자산 대비 ≤10% | 주문 거부 |
| 동일 섹터 노출도 | 총자산 대비 ≤30% | 주문 거부 |
| 일일 거래 횟수 | 종목별 ≤20회 | 일시적 중지 |
| 주문 크기 대비 유동성 | 평균 거래량의 5% 이하 | 주문 분할 실행 |
| 가격 이상치 검증 | 20일 평균 대비 ±15% | 수동 확인 요청 |

### 2.2 Layer 2: 포지션 보호 (Position Guard)
**목적**: 열린 포지션의 실시간 모니터링 및 보호

- **동적 손절매**:
  - 기본: 진입가 대비 -7%
  - 변동성 조정: ATR(14) × 2를 반영한 동적 수준
  - 섹터 하락 시: 추가 -2% 강화

- **이익 보호**:
  - 트레일링 스탑: 최고점 대비 -3%
  - 부분 청산: 15% 수익 시 원금 50% 회수

- **유동성 감시**:
  - 호가 창 스프레드 > 0.5% 시 주문 중지
  - 거래량 1시간 평균 대비 80% 감소 시 알림

### 2.3 Layer 3: 회로 차단기 (Circuit Breaker)
**목적**: 시스템 수준의 급격한 손실 방지

**단계적 차단 메커니즘**:

Level 1 (경고): 일일 손실 -1.5%
  - 새 포지션 진입 50% 제한
  - 기존 포지션 헤징 권장
  
Level 2 (제한): 일일 손실 -2.0%
  - 새 매수 주문 전면 중지
  - 매도 주문만 허용
  - 레버리지 포지션 강제 감소
  
Level 3 (차단): 일일 손실 -2.5%
  - 모든 신규 주문 중지
  - 시장가 청산 모드 발동 (손절매만 실행)
  
Level 4 (비상): 일일 손실 -3.0%
  - 모든 주문 취소
  - Layer 4(비상 정지) 활성화


### 2.4 Layer 4: 비상 정지 (Emergency Stop)
**목적**: 최악의 시나리오에서 자본 보호

**활성화 조건**:
1. 일일 손실 한도(-3%) 초과
2. 시스템 오류로 인한 연속 오주문 (5회 이상)
3. 외부 데이터 피드 신뢰도 하락 (지연 > 5초)
4. 수동 오버라이드 요청

**실행 절차**:
1. 모든 미체결 주문 즉시 취소
2. 시장가로 모든 포지션 청산 (예외: 유동성 부족 시 단계적 청산)
3. 거래 API 키 비활성화
4. 관리자에게 3단계 알림 발송 (SMS, 이메일, 모바일 푸시)
5. 시스템 로그 전체 보관

---

## 3. 자동화된 대응 프로세스

### 3.1 이벤트 → 감지 → 대응 → 복구 사이클


이벤트 발생
    ↓
실시간 감지 (모니터링 에이전트)
    ↓
위험 등급 분류 (Low/Medium/High/Critical)
    ↓
자동 대응 실행 (레이어별 프로토콜)
    ↓
효과성 검증 (5분 내 결과 확인)
    ↓
상태 복구 또는 수동 개입 요청
    ↓
사후 분석 보고서 자동 생성


### 3.2 대응 매트릭스

| 위험 유형 | 감지 지표 | 1차 대응 | 2차 대응 | 복구 조건 |
|----------|----------|----------|----------|-----------|
| 유동성 위험 | 스프레드 > 1%, 거래량 70%↓ | 주문 분할 | 시장가→지정가 전환 | 스프레드 < 0.3% |
| 변동성 급등 | 5분 내 ±3% 이상 | Volatility Filter 적용 | 포지션 크기 50%↓ | 변동성 1시간 평균 복귀 |
| 시스템 오류 | 응답 지연 > 3초 | 보조 데이터 소스 전환 | 거래 속도 제한 | 정상 응답 10분 유지 |
| 섹터 쇼크 | 섹터지수 -5% 이상 | 해당 섹터 노출도 0% | 상관관계 높은 종목 헤징 | 지수 2시간 안정화 |

---

## 4. 백테스트 검증 결과

### 4.1 안전장치 ON/OFF 성과 비교 (2020-2023)

| 지표 | 안전장치 OFF | 안전장치 ON | 개선 효과 |
|------|-------------|------------|-----------|
| 최대 낙폭(MDD) | -42.3% | **-18.7%** | 23.6%p 감소 |
| 샤프 비율 | 0.82 | **1.24** | 51.2% 향상 |
| 승률 | 54.1% | **56.3%** | 2.2%p 향상 |
| 평균 손실 거래 | -2.8% | **-1.9%** | 32.1% 감소 |
| 한국전력 사태 시 손실 | -15.2% | **-4.3%** | 10.9%p 감소 |

### 4.2 시뮬레이션 시나리오 테스트

1. **플래시 크래시 시뮬레이션**
   - 조건: 5분 내 -8% 급락 → +5% 반등
   - 결과: 안전장치 ON 시 -1.2% 손실, OFF 시 -5.8% 손실

2. **유동성 소실 시나리오**
   - 조건: 평균 거래량 80% 감소
   - 결과: 주문 실행 실패율 67% → 12% 개선

3. **데이터 피드 장애**
   - 조건: 주요 피드 30초 지연
   - 결과: 백업 피드 전환 완료 시간 2.1초

---

## 5. 실시간 모니터링 대시보드

### 5.1 핵심 지표


[시스템 상태] ● 정상 (Updated: 2024-01-20 14:30:05)
├── 일일 실현 손익: +1.2% (한도: -3.0%)
├── 미실현 손익: +0.8%
├── 포지션 개수: 8/12 (67%)
├── 레이어 상태: 모든 레이어 정상
└── 마지막 이슈: 없음


### 5.2 상세 모니터링 패널

#### A. 자본 보호 패널
- **누적 손실 한도**: -1.8% / -3.0% (60% 사용)
- **단일 종목 노출**: 최대 7.3% / 10% (한국전력)
- **섹터 집중도**: 최대 24.1% / 30% (전기 utilities)
- **레버리지 비율**: 1.8x / 3.0x

#### B. 시장 상태 패널
- **전체 시장 변동성(VROK)**: 18.2 (높음)
- **유동성 점수**: 76/100 (양호)
- **이상 거래 감지**: 0건 (24시간 내)
- **데이터 지연**: 0.8초 / 3.0초

#### C. 시스템 건강도 패널
- **API 응답 시간**: 120ms
- **주문 체결률**: 98.7%
- **오류 발생률**: 0.02%
- **CPU/메모리 사용률**: 42%/68%

### 5.3 경고 등급별 표시

| 등급 | 표시 색상 | 자동 조치 | 수동 개입 필요 |
|------|-----------|-----------|----------------|
| 정상 | 녹색 | 없음 | 아니오 |
| 주의 | 노란색 | 모니터링 강화 | 아니오 |
| 경계 | 주황색 | 부분적 거래 제한 | 30분 내 |
| 위험 | 빨간색 | 신규 주문 중지 | 즉시 |
| 비상 | 깜빡임(빨강) | 전체 거래 중지 | 이미 개입됨 |

---

## 6. 비상 정지 후 복구 절차

### 6.1 자동 복구 검증 체크리스트


[1단계] 원인 분석 완료
    ✓ 이벤트 로그 확인
    ✓ 손실 원인 식별
    ✓ 시스템 오류 점검

[2단계] 시장 상태 평가
    ✓ 주요 지표 안정화 확인 (변동성 < 25%)
    ✓ 유동성 회복 확인 (거래량 > 70일 평균 60%)
    ✓ 관련 뉴스/이벤트 확인

[3단계] 시스템 검증
    ✓ 모든 데이터 피드 연결 테스트
    ✓ API 키 재발급 및 테스트
    ✓ 백업 시스템 점검

[4단계] 단계적 재개
    → 모의 거래 모드 30분 실행
    → 실거래 10% 제한 모드 (1시간)
    → 50% 제한 모드 (2시간)
    → 완전 재개 (모든 검증 통과 시)


### 6.2 수동 재개 승인 조건
1. **최소 2명의 승인자** 확인 (트레이더 + 리스크 관리자)
2. **원인 분석 보고서** 검토 완료
3. **시장 조건**이 안정적임 확인 (3시간 이상)
4. **모의 거래 테스트** 95% 이상 정상 실행
5. **손실 한도 재설정** 및 위험 프레임워크 업데이트

### 6.3 사후 분석 보고서
비상 정지 발생 시 자동 생성되는 보고서 포함 항목:
1. 타임라인 재구성 (이벤트 발생 ~ 복구 완료)
2. 손실 원인 및 책임 소재 분석
3. 시스템 대응 효과성 평가
4. 개선 권고사항 (7일 내 구현 목표)
5. 재발 방지 프로토콜 업데이트

---

## 7. 유지보수 및 업데이트

### 7.1 정기 점검
- **일일**: 로그 검토, 한도 확인, 백업 테스트
- **주간**: 성과 분석, 파라미터 조정, 시나리오 테스트
- **월간**: 전체 시스템 감사, 레포팅, 규정 준수 점검

### 7.2 버전 관리
- 모든 변경사항은 버전 기록에 명시
- 주요 업데이트는 모의 거래 환경에서 72시간 테스트
- 롤백 프로시저 항상 준비

### 7.3 교육 및 문서화
- 운영자 주기적 교육 (분기별)
- 비상 대응 매뉴얼 실전 훈련 (반기별)
- 모든 이슈는 지식베이스에 기록

---

## 8. 결론

AEGIS v3.1은 실제 시장 사태에서 얻은 교훈을 체계적으로 반영한 안전 시스템입니다. 다중 레이어 방어, 자동화된 대응, 철저한 모니터링, 그리고 체계적인 복구 절차를 통해 자동 매매 시스템의 견고성을 확보합니다. 본 시스템은 지속적인 개선을 원칙으로 하며, 새로운 시장 환경과 리스크 요인에 맞춰 진화할 것입니다.

---

**문서 정보**
- 버전: AEGIS v3.1
- 최종 업데이트: 2024년 1월 20일
- 적용 시작일: 2024년 2월 1일
- 이전 버전: v3.0 (2023년 10월)
- 다음 검토 예정: 2024년 4월 30일

**승인자**
- 시스템 아키텍트: ______
- 리스크 관리자: ______
- 컴플라이언스 담당자: ______
