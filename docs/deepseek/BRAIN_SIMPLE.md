# AEGIS BRAIN v3.1
*AI 기반 자동 주식 매매 의사결정 시스템*

---

## 🎯 핵심 개요


[주식 데이터 수집] → [AI 분석 엔진] → [의사결정] → [실행]
        │                  │              │           │
    실시간 가격    4개 AI 협업      점수 기반    안전장치
    재무제표       (역할 분담)      조건 검증    적용


---

## 📊 AI 협업 구조 (역할 분담)

```ascii
┌─────────────────────────────────────────────────────────┐
│                     입력: 종목 리스트                    │
└───────────────────────────┬─────────────────────────────┘
                            │
                    ┌───────▼────────┐
                    │   gemini-flash  │  ← 빠른 스크리닝 (1차 필터링)
                    │  (0.0075$/1M)  │      저비용 고속 처리
                    └───────┬────────┘
                            │
                    ┌───────▼────────┐
                    │  deepseek-v3   │  ← 메인 분석 (57% 가중치)
                    │  (0.14$/1M)   │      기본 점수 산출
                    └───────┬────────┘
                            │
┌───────────────────┐       │       ┌───────────────────┐
│   Quant 모델      │◄──────┼──────►│   deepseek-r1    │
│   (43% 가중치)    │       │       │  (2.94$/1M)      │
│   기술적 지표     │       │       │  고액 매수 검증   │
│   시장 심리       │       │       │  (100만원 이상)   │
└───────────────────┘       │       └───────────────────┘
                            │
                    ┌───────▼────────┐
                    │ 최종 점수 계산  │  ← v3(57%) + Quant(43%)
                    │   (≥70점 통과) │
                    └───────┬────────┘
                            │
                    ┌───────▼────────┐
                    │  claude-opus-4.5 │  ← 매매 실행 담당
                    │   (3.0$/1M)    │      실시간 주문 처리
                    └─────────────────┘


---

## 🔢 점수 계산 체계

### 1. **최종 점수 = AI 점수(57%) + Quant 점수(43%)**

**AI 점수 구성 (deepseek-v3)**
- 기본 점수: 0~100점
- 평가 요소:
  - 재무건전성 (30%)
  - 성장성 (25%)
  - 시장평가 (20%)
  - 산업전망 (15%)
  - 리스크요소 (10%)

**Quant 점수 구성**
- 기술적 지표: RSI, MACD, 볼린저밴드 (40%)
- 시장 심리: 거래량, 외인/기관 흐름 (35%)
- 변동성: 베타, ATR (25%)

### 2. **Safety Check (안전성 검증)**
- [ ] PER ≤ 산업 평균의 120%
- [ ] 부채비율 ≤ 150%
- [ ] 거래량 ≥ 20일 평균의 70%
- [ ] 시가총액 ≥ 1,000억 원
- *모든 조건 통과 시 매수 가능*

---

## 🛒 매수/매도 규칙

### **매수 조건 (AND 조건)**
1. 최종 점수 ≥ 70점
2. Safety Check 4항목 모두 통과
3. 현재 보유 종목 수 < 10종목 (분산 투자)
4. 종목당 최대 투자금: 총 자산의 15%

### **매도 조건 (OR 조건)**

실시간 모니터링
    │
    ├─ 손절: -2% → 즉시 매도 (손실 제한)
    │
    ├─ 분할 익절: +3.5% → 30% 매도 (부분 확보)
    │
    ├─ 트레일링 스탑: 고점 대비 -5% → 전량 매도
    │   (고점 갱신 시 5% 트레일링)
    │
    └─ 강화 익절: +8% → 전량 매도 (강력한 상승)


---

## 📈 실전 예시: 삼성전자(005930)

### **2024년 1월 15일 분석**

**deepseek-v3 분석 결과**
- 재무건전성: 85/100 (건전한 재무구조)
- 성장성: 72/100 (D램 가격 상승 기대)
- 시장평가: 68/100 (PER 11.5배, 적정)
- 산업전망: 80/100 (AI 반도체 수요 증가)
- 리스크요소: 65/100 (글로벌 경기 불확실성)
- **AI 기본 점수: 75.2점**

**Quant 점수**
- 기술적: 70/100 (RSI 58, 상승 추세)
- 시장심리: 68/100 (기관 순매수 지속)
- 변동성: 72/100 (안정적 변동성)
- **Quant 점수: 69.8점**

**최종 점수 계산**

AI 점수(57%): 75.2 × 0.57 = 42.86
Quant 점수(43%): 69.8 × 0.43 = 30.01
최종 점수: 72.87점 → 매수 조건 충족


**Safety Check 결과**
- PER 11.5배 ≤ 반도체 평균 13배 ✓
- 부채비율 12% ≤ 150% ✓
- 거래량 8.2M주 ≥ 평균 7.5M주 ✓
- 시가총액 384조원 ≥ 1,000억원 ✓
- **모두 통과 → 매수 실행**

---

## 🧪 백테스트 결과 반영

### **Stop-loss 전략 비교 (2023년 1년)**
| 전략 | 승률 | 평균수익률 | 최대손실(MDD) | 샤프비율 |
|------|------|------------|--------------|----------|
| Tight Stop(-2%) | 58.3% | +12.4% | -18.7% | 1.42 |
| **Wide Stop(-7%)** | **62.1%** | **+16.8%** | **-14.2%** | **1.78** |
| No Stop | 55.7% | +9.3% | -32.5% | 0.95 |

**결론: Wide Stop(-7%) 전략 채택**
- 변동성 충분히 흡수 가능
- 조기 매도로 인한 기회비용 감소
- MDD 개선 효과显著

---

## 💰 AI 비용 최적화 전략

### **1. 캐싱 레이어 도입**

분석 요청
    │
    ├─ 캐시 히트? → 캐시된 결과 반환 (비용 0원)
    │   (24시간 내 동일 종목 분석)
    │
    └─ 캐시 미스? → AI 분석 실행 → 결과 캐싱


### **2. 요청별 비용 비교**
| AI 모델 | 용도 | 백만토큰당 가격 | 월 예상 비용 |
|---------|------|----------------|-------------|
| gemini-flash | 스크리닝 | $0.0075 | ~$15 |
| deepseek-v3 | 메인 분석 | $0.14 | ~$280 |
| deepseek-r1 | 고액 검증 | $2.94 | ~$150 (사용량 제한) |
| claude-opus | 실행 | $3.0 | ~$200 |
| **총계** | - | - | **~$645/월** |

### **3. 비용 절감 방안**
- 캐싱 적중률 60% 목표 → 비용 40% 절감
- deepseek-r1 호출 제한: 100만원 이상 매수 시만
- 야간 분석: 20시~09시 (트래픽 할인 활용)

---

## 📊 측정 KPI (성과 지표)

### **주간 리포트 항목**
1. **수익률**
   - 주간 수익률
   - 누적 수익률 (연초 대비)
   - 벤치마크 대비 초과 수익률 (KOSPI)

2. **위험 조정 수익**
   - 샤프비율 (목표 ≥ 1.5)
   - 소르티노비율 (하방 위험 조정)
   - 최대 낙폭(MDD) (목표 ≤ -15%)

3. **거래 효율성**
   - 승률 (목표 ≥ 60%)
   - 평균 손익비 (Profit Factor) (목표 ≥ 1.8)
   - 총 거래 횟수
   - AI 분석 비용 대비 수익률

4. **AI 성능**
   - 점수 대비 실제 수익률 상관관계
   - False Positive Rate (매수 후 하락 비율)
   - 분석 캐시 히트률

---

## 🚀 향후 개선 방향

### **단기 (1개월)**
- 실시간 모니터링 대시보드 구축
- 이상 거래 감지 시스템 추가

### **중기 (3개월)**
- 강화학습 기반 매매 타이밍 최적화
- 시장 상황별 파라미터 자동 조정

### **장기 (6개월)**
- 멀티 에이전트 협업 시스템 고도화
- 예측 설명 가능성(XAI) 기능 추가

---

## ⚠️ 주요 리스크 및 제한사항

1. **시장 리스크**
   - 시스템은 블랙스완 이벤트 대응 능력 제한적
   - 과거 데이터 기반 학습의 한계

2. **기술적 리스크**
   - API 장애 시 거래 중단 가능성
   - AI 모델의 편향(bias) 포함 가능성

3. **운영 리스크**
   - 초고빈도 거래에 최적화되지 않음
   - 법적/제도적 변경 대응 필요

---

**버전: v3.1 | 최종 업데이트: 2024년 1월**
*본 시스템은 보조적 의사결정 도구이며, 투자 판단의 최종 책임은 사용자에게 있습니다.*


---

## 🔧 구현 체크리스트

- [ ] AI 분석 결과 캐싱 시스템 구현 (Redis/MongoDB)
- [ ] Safety Check 자동화 스크립트
- [ ] 실시간 모니터링 알림 시스템 (Telegram/이메일)
- [ ] 주간 KPI 리포트 자동 생성
- [ ] 비용 모니터링 대시보드
- [ ] 백테스트 파라미터 최적화 도구

*문서는 실제 구현 상황에 맞게 수정되어야 합니다. AI 모델 가격은 2024년 1월 기준입니다.*
