# AI Reasoning Visualizer Specification

> **프레젠테이션 퀄리티의 AI 추론 과정 시각화 시스템**

## 📋 목차

1. [개요](#개요)
2. [핵심 가치](#핵심-가치)
3. [시스템 아키텍처](#시스템-아키텍처)
4. [상세 문서](#상세-문서)

---

## 개요

### 목적

AEGIS v3.0의 AI 추론 과정을 **인간이 인지 가능한 수준**으로 시각화하여:
- AI의 의사결정 과정 투명성 확보
- 글로벌 데이터 흐름 이해도 향상
- 시스템 신뢰도 제고
- 프레젠테이션/데모 용도로 활용

### 범위

```
┌─────────────────────────────────────────────────────────────────────┐
│                    🌍 GLOBAL DATA FLOW                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  입력: 글로벌 Fetcher                출력: 최종 3종목              │
│  ─────────────────────                ───────────────              │
│  • 🇺🇸 미국 (Fed, S&P500)              1. 삼성전자                │
│  • 🇪🇺 유럽 (ECB, DAX)                 2. SK하이닉스              │
│  • 🇯🇵 일본 (Nikkei, 엔화)             3. LG에너지솔루션          │
│  • 🇨🇳 중국 (상해종합, 위안화)                                     │
│  • 🥇 금, 은 (안전자산)                                            │
│  • 🛢️ WTI, 구리, 철광석 (원자재)                                   │
│  • 📰 뉴스 (긍정/부정 감성)                                        │
│                                                                     │
│         ↓ 실시간 수집                                               │
│                                                                     │
│  ┌──────────────────────────────────────────────┐                  │
│  │        🧠 AEGIS Brain Fusion Point            │                  │
│  │                                               │                  │
│  │  Phase 1: Signal Fusion                      │                  │
│  │  • 긍정 신호 → 밝게 유입                      │                  │
│  │  • 부정 신호 → 어둡게 탈락                    │                  │
│  │                                               │                  │
│  │  Phase 2: Flash Filter (Gemini 2.0 Flash)    │                  │
│  │  • 2,500 종목 → 50 종목                       │                  │
│  │  • 빠른 회전 애니메이션                       │                  │
│  │                                               │                  │
│  │  Phase 3: Pro Reasoning (Gemini 2.5 Pro)     │                  │
│  │  • 50 종목 → 3 종목                           │                  │
│  │  • 깊은 맥동 + 연결선 수렴                    │                  │
│  │                                               │                  │
│  └──────────────────────────────────────────────┘                  │
│                                                                     │
│         ↓ 최종 결과                                                 │
│                                                                     │
│  ┌──────────────────────────────────────────────┐                  │
│  │  📊 결과 카드 (각 종목)                       │                  │
│  │                                               │                  │
│  │  삼성전자                                     │                  │
│  │  ├─ 🇺🇸 S&P500 상승 (긍정)                    │                  │
│  │  ├─ 🛢️ WTI 하락 (긍정 - 제조원가↓)            │                  │
│  │  └─ 📰 "반도체 슈퍼사이클" (긍정)             │                  │
│  │                                               │                  │
│  └──────────────────────────────────────────────┘                  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 핵심 가치

### 1. 투명성 (Transparency)

**문제**: "AI가 왜 이 종목을 선택했는지 모르겠어요"

**해결**:
- 모든 입력 신호의 시각적 추적
- 각 필터링 단계의 실시간 표시
- 최종 결정에 영향을 준 요인 명시

### 2. 신뢰성 (Trust)

**문제**: "AI 추천을 믿어도 될까요?"

**해결**:
- 글로벌 데이터 소스 명확히 표시
- 긍정/부정 신호의 객관적 분류
- 히스토리 재생으로 검증 가능

### 3. 교육성 (Education)

**문제**: "투자 논리를 이해하고 싶어요"

**해결**:
- 글로벌 경제 → 한국 주식 연결고리 시각화
- 각 신호의 영향력 강도 표시
- 단계별 슬로우 모션 재생

### 4. 프레젠테이션 (Presentation)

**문제**: "시스템을 어떻게 설명하죠?"

**해결**:
- 인상적인 애니메이션
- 직관적인 색상/움직임
- 데모 모드 제공

---

## 시스템 아키텍처

### 고수준 구조

```
┌─────────────────────────────────────────────────────────────────────┐
│                         System Layers                                │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  [Layer 1] Data Collection                                          │
│  ─────────────────────────────────────────────────────────────────  │
│  fetchers/global_fetcher.py  →  signal_logs 테이블                  │
│                                                                     │
│  [Layer 2] Database                                                 │
│  ─────────────────────────────────────────────────────────────────  │
│  PostgreSQL 16                                                      │
│  • analysis_batches (실행 세션)                                     │
│  • signal_sources (데이터 소스 정의)                                │
│  • signal_logs (수집된 신호)                                        │
│  • analysis_steps (단계별 진행)                                     │
│  • analysis_stocks (종목별 상세)                                    │
│  • signal_stock_impacts (영향 매핑)                                 │
│                                                                     │
│  [Layer 3] Backend API                                              │
│  ─────────────────────────────────────────────────────────────────  │
│  FastAPI                                                            │
│  • REST API (히스토리 조회)                                         │
│  • WebSocket (실시간 스트리밍)                                      │
│  • 집계 쿼리 (성능 최적화)                                          │
│                                                                     │
│  [Layer 4] Frontend Visualization                                   │
│  ─────────────────────────────────────────────────────────────────  │
│  React + TypeScript                                                 │
│  • Canvas (파티클 애니메이션)                                       │
│  • Three.js (3D 배경)                                               │
│  • Framer Motion (UI 전환)                                          │
│  • TanStack Query (데이터 페칭)                                     │
│                                                                     │
│  [Layer 5] Control Dashboard                                        │
│  ─────────────────────────────────────────────────────────────────  │
│  관제 시스템 (Admin)                                                │
│  • 실행 중인 배치 모니터링                                          │
│  • 성능 지표 확인                                                   │
│  • 오류 로그 추적                                                   │
│  • 히스토리 재생 제어                                               │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 데이터 흐름

```
┌─────────────────────────────────────────────────────────────────────┐
│                         Data Flow                                    │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  1. Trigger (스케줄 or 수동)                                        │
│     ↓                                                               │
│  2. Batch 생성 (analysis_batches INSERT)                            │
│     ↓                                                               │
│  3. Fetcher 실행                                                    │
│     ├─ global_fetcher.py (글로벌 지표/뉴스)                         │
│     ├─ krx_fetcher.py (한국 종목)                                   │
│     └─ → signal_logs, analysis_stocks 테이블 BULK INSERT            │
│     ↓                                                               │
│  4. Brain 분석                                                      │
│     ├─ Phase 1: Signal Fusion                                       │
│     │   • 긍정/부정 점수 계산                                        │
│     │   • signal_logs UPDATE (sentiment_score)                      │
│     │                                                               │
│     ├─ Phase 2: Flash Filter (Gemini 2.0 Flash)                     │
│     │   • 2,500 → 50 종목                                            │
│     │   • analysis_stocks UPDATE (status='FILTERED')                │
│     │   • analysis_steps INSERT (FLASH_FILTER 완료)                 │
│     │                                                               │
│     └─ Phase 3: Pro Reasoning (Gemini 2.5 Pro)                      │
│         • 50 → 3 종목                                                │
│         • analysis_stocks UPDATE (status='SELECTED')                │
│         • signal_stock_impacts INSERT (영향 매핑)                   │
│         • analysis_steps INSERT (PRO_REASON 완료)                   │
│     ↓                                                               │
│  5. 결과 저장                                                       │
│     └─ analysis_batches UPDATE (status='COMPLETED')                 │
│     ↓                                                               │
│  6. 시각화                                                          │
│     ├─ [실시간 모드]                                                │
│     │   • WebSocket으로 단계별 이벤트 스트리밍                       │
│     │   • Frontend가 애니메이션 실행                                 │
│     │                                                               │
│     └─ [히스토리 모드]                                              │
│         • batch_id로 전체 과정 조회                                 │
│         • 타임라인 슬라이더로 재생                                   │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 상세 문서

이 시스템은 다음 하위 문서로 구성됩니다:

### 1. [TECH_STACK.md](./TECH_STACK.md)
기술 스택 상세 (반응형 + 성능 최적화)

### 2. [CONTROL_SYSTEM.md](./CONTROL_SYSTEM.md)
관제 시스템 설계 (백엔드 핸들링)

### 3. [DATABASE_SCHEMA.md](./DATABASE_SCHEMA.md)
데이터베이스 스키마 상세

### 4. [ANIMATION_SPEC.md](./ANIMATION_SPEC.md)
애니메이션 타임라인 및 구현 방법

### 5. [API_ENDPOINTS.md](./API_ENDPOINTS.md)
REST API + WebSocket 엔드포인트

---

## 개발 단계

### Phase 1: 데이터베이스 및 백엔드 (1주)

- [ ] DB 스키마 생성 (Alembic migration)
- [ ] Fetcher 수정 (signal_logs 저장)
- [ ] Brain 수정 (단계별 로그)
- [ ] REST API 구현
- [ ] WebSocket 스트리밍

### Phase 2: 시각화 기본 (1주)

- [ ] Canvas 파티클 시스템
- [ ] 기본 애니메이션 구현
- [ ] 실시간 데이터 연동
- [ ] 반응형 레이아웃

### Phase 3: 고급 기능 (1주)

- [ ] Three.js 3D 배경
- [ ] 히스토리 재생
- [ ] 관제 시스템
- [ ] 성능 최적화

### Phase 4: 테스트 및 개선 (1주)

- [ ] 모바일 테스트
- [ ] 성능 프로파일링
- [ ] UX 개선
- [ ] 문서화 완료

---

## 성능 목표

| 항목 | 목표 | 비고 |
|-----|------|------|
| 데이터 수집 | < 10초 | 모든 Fetcher 병렬 실행 |
| DB 저장 | < 100ms | BULK INSERT |
| WebSocket 지연 | < 50ms | 단계별 이벤트 |
| 애니메이션 FPS | 60 FPS | Canvas 최적화 |
| 히스토리 로드 | < 500ms | 집계 쿼리 사용 |
| 모바일 성능 | 30+ FPS | 파티클 수 동적 조절 |

---

## 다음 단계

각 상세 문서를 읽고 개발을 시작하세요:

1. **백엔드 개발자** → [DATABASE_SCHEMA.md](./DATABASE_SCHEMA.md) + [API_ENDPOINTS.md](./API_ENDPOINTS.md)
2. **프론트엔드 개발자** → [TECH_STACK.md](./TECH_STACK.md) + [ANIMATION_SPEC.md](./ANIMATION_SPEC.md)
3. **DevOps** → [CONTROL_SYSTEM.md](./CONTROL_SYSTEM.md)

---

**작성일**: 2025-12-08
**작성자**: wonny
**버전**: 1.0.0
