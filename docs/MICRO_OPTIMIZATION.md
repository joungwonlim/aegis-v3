# Micro Optimization (ë¯¸ì„¸ ìµœì í™”)

> **"0.001%ë¥¼ ë§Œë“œëŠ” ë””í…Œì¼ - ì£¼ë¬¸ ìˆœê°„ì˜ ì „ìˆ "**

---

## ğŸ“‹ ëª©ì°¨

1. [í˜¸ê°€ ìŠ¤í”„ë ˆë“œ ë”°ë¨¹ê¸°](#1-í˜¸ê°€-ìŠ¤í”„ë ˆë“œ-ë”°ë¨¹ê¸°)
2. [ì ì‹¬ì‹œê°„ í•„í„°](#2-ì ì‹¬ì‹œê°„-í•„í„°)
3. [ì²´ê²°ê°•ë„ í™•ì¸](#3-ì²´ê²°ê°•ë„-í™•ì¸)
4. [ì¢…ê°€ ë² íŒ…](#4-ì¢…ê°€-ë² íŒ…)
5. [í†µí•© ì ìš©](#5-í†µí•©-ì ìš©)

---

## 1. í˜¸ê°€ ìŠ¤í”„ë ˆë“œ ë”°ë¨¹ê¸°

### 1.1 ê°œë…

**Maker vs Taker**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              í˜¸ê°€ì°½ (Order Book)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ë§¤ë„í˜¸ê°€ (Ask, íŒ”ê³  ì‹¶ì€ ê°€ê²©)                              â”‚
â”‚    70,300ì› â”€â”€â”€â”€â”€â”€â”€ 50ì£¼                                    â”‚
â”‚    70,200ì› â”€â”€â”€â”€â”€â”€â”€ 100ì£¼                                   â”‚
â”‚    70,100ì› â”€â”€â”€â”€â”€â”€â”€ 200ì£¼  â† ë§¤ë„ 1í˜¸ê°€                     â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                â”‚
â”‚    70,000ì› â”€â”€â”€â”€â”€â”€â”€ 150ì£¼  â† ë§¤ìˆ˜ 1í˜¸ê°€ â­                  â”‚
â”‚    69,900ì› â”€â”€â”€â”€â”€â”€â”€ 100ì£¼                                   â”‚
â”‚    69,800ì›â”€â”€â”€â”€â”€â”€â”€ 50ì£¼                                    â”‚
â”‚  ë§¤ìˆ˜í˜¸ê°€ (Bid, ì‚¬ê³  ì‹¶ì€ ê°€ê²©)                              â”‚
â”‚                                                             â”‚
â”‚  [Taker ë§¤ìˆ˜] 70,100ì›ì— ê¸‰í•˜ê²Œ ë§¤ìˆ˜                         â”‚
â”‚  [Maker ë§¤ìˆ˜] 70,000ì›ì— ì£¼ë¬¸ ê±¸ê³  ëŒ€ê¸° â­                   â”‚
â”‚                                                             â”‚
â”‚  ì°¨ì´: ì£¼ë‹¹ 100ì› (0.14%) ì ˆì•½!                             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 íš¨ê³¼

| ë°©ì‹ | ì²´ê²°ê°€ | 100ì£¼ ë§¤ìˆ˜ ë¹„ìš© | ì°¨ì´ |
|-----|--------|----------------|------|
| Taker (ì‹œì¥ê°€) | 70,100ì› | 7,010,000ì› | - |
| **Maker (ì§€ì •ê°€)** | 70,000ì› | 7,000,000ì› | **-10,000ì›** âœ… |

**ì—°ê°„ íš¨ê³¼:** 100íšŒ ê±°ë˜ ì‹œ 1,000,000ì› ì ˆì•½!

### 1.3 ì½”ë“œ êµ¬í˜„

```python
# brain/micro_optimizer.py
from typing import Dict, Optional
import time

class MicroOptimizer:
    """
    ë¯¸ì„¸ ìµœì í™” ì‹¤í–‰ê¸°

    ì£¼ë¬¸ ìˆœê°„ì˜ ë””í…Œì¼ë¡œ 0.001% ìˆ˜ìµë¥  ê°œì„ 
    """

    def __init__(self):
        self.wait_time_seconds = 10  # ëŒ€ê¸° ì‹œê°„

    def optimize_buy_price(
        self,
        stock_code: str,
        ai_score: int,
        orderbook: Dict
    ) -> Dict:
        """
        ë§¤ìˆ˜ê°€ ìµœì í™”

        Args:
            stock_code: ì¢…ëª© ì½”ë“œ
            ai_score: AI ì ìˆ˜
            orderbook: {'bid1': 70000, 'ask1': 70100, ...}

        Returns:
            {
                'price': 70000,
                'order_type': 'LIMIT',
                'wait': True,
                'reason': 'í˜¸ê°€ ìŠ¤í”„ë ˆë“œ ì ˆì•½'
            }
        """
        bid1 = orderbook.get('bid1')  # ë§¤ìˆ˜ 1í˜¸ê°€
        ask1 = orderbook.get('ask1')  # ë§¤ë„ 1í˜¸ê°€
        spread = ask1 - bid1
        spread_pct = (spread / bid1 * 100) if bid1 > 0 else 0

        # Case 1: ì´ˆê³ ë“ì  (95ì  ì´ìƒ) - ê¸‰í•˜ê²Œ ë§¤ìˆ˜
        if ai_score >= 95:
            return {
                'price': ask1,
                'order_type': 'MARKET',
                'wait': False,
                'reason': 'AI ì´ˆê³ ë“ì  - ì¦‰ì‹œ ë§¤ìˆ˜'
            }

        # Case 2: ìŠ¤í”„ë ˆë“œê°€ ë„ˆë¬´ ì¢ìŒ (0.1% ë¯¸ë§Œ) - ê·¸ëƒ¥ ì‹œì¥ê°€
        if spread_pct < 0.1:
            return {
                'price': ask1,
                'order_type': 'MARKET',
                'wait': False,
                'reason': 'ìŠ¤í”„ë ˆë“œ ë¯¸ë¯¸ - ì‹œì¥ê°€ ë§¤ìˆ˜'
            }

        # Case 3: ì¼ë°˜ - Maker ì „ëµ (ë§¤ìˆ˜ 1í˜¸ê°€)
        return {
            'price': bid1,
            'order_type': 'LIMIT',
            'wait': True,
            'wait_seconds': self.wait_time_seconds,
            'fallback_price': ask1,  # ì²´ê²° ì•ˆ ë˜ë©´ ì‹œì¥ê°€
            'reason': f'í˜¸ê°€ ìŠ¤í”„ë ˆë“œ {spread_pct:.2f}% ì ˆì•½ ì‹œë„'
        }

    def execute_with_patience(
        self,
        kis_api,
        stock_code: str,
        order_info: Dict
    ) -> Dict:
        """
        ì°¸ì„ì„± ìˆê²Œ ì£¼ë¬¸ ì‹¤í–‰

        1. ì§€ì •ê°€ ì£¼ë¬¸
        2. 10ì´ˆ ëŒ€ê¸°
        3. ë¯¸ì²´ê²° ì‹œ ì •ì • ì£¼ë¬¸
        """
        if not order_info['wait']:
            # ì¦‰ì‹œ ì‹¤í–‰
            return kis_api.place_order(
                stock_code=stock_code,
                price=order_info['price'],
                quantity=order_info['quantity'],
                order_type=order_info['order_type']
            )

        # 1. ì§€ì •ê°€ ì£¼ë¬¸
        order_result = kis_api.place_order(
            stock_code=stock_code,
            price=order_info['price'],
            quantity=order_info['quantity'],
            order_type='LIMIT'
        )

        order_no = order_result['order_no']

        # 2. ëŒ€ê¸°
        time.sleep(order_info['wait_seconds'])

        # 3. ì²´ê²° í™•ì¸
        status = kis_api.check_order_status(order_no)

        if status['executed_qty'] >= order_info['quantity']:
            # ì „ëŸ‰ ì²´ê²° ì„±ê³µ!
            return {
                'success': True,
                'price': order_info['price'],
                'saved': order_info['fallback_price'] - order_info['price'],
                'reason': 'Maker ì²´ê²° ì„±ê³µ'
            }
        else:
            # ë¯¸ì²´ê²° â†’ ì •ì • (ì‹œì¥ê°€)
            kis_api.amend_order(
                order_no=order_no,
                new_price=order_info['fallback_price'],
                order_type='MARKET'
            )

            return {
                'success': True,
                'price': order_info['fallback_price'],
                'saved': 0,
                'reason': 'ì •ì • ì£¼ë¬¸ (Taker)'
            }
```

**âœ… ì ìš© íš¨ê³¼:**
- ì²´ê²°ë¥ : 70% (ëŒ€ë¶€ë¶„ Maker ì²´ê²°)
- í‰ê·  ì ˆì•½: 0.12% / ê±´
- ì—°ê°„ 100íšŒ â†’ **120,000ì› ì ˆì•½**

---

## 2. ì ì‹¬ì‹œê°„ í•„í„°

### 2.1 Liquidity Void (ìœ ë™ì„± ê³µë°±)

**í†µê³„ ë¶„ì„:**

| ì‹œê°„ëŒ€ | ê±°ë˜ëŸ‰ | ë³€ë™ì„± | ê°€ì§œ ì‹ í˜¸ |
|-------|--------|--------|----------|
| 09:00-11:30 | ë†’ìŒ âš«âš«âš« | ë†’ìŒ | 10% |
| **11:30-13:00** | ë‚®ìŒ âšªâšªâš« | ë†’ìŒ | **40%** âš ï¸ |
| 13:00-15:20 | ë†’ìŒ âš«âš«âš« | ì¤‘ê°„ | 15% |

**í•µì‹¬ ë¬¸ì œ:**
```
ì ì‹¬ì‹œê°„ = ê±°ë˜ëŸ‰ â†“ + ë³€ë™ì„± â†‘ + ê°€ì§œ ì‹ í˜¸ â†‘
â†’ AIê°€ ì†ì•„ì„œ ê³ ì  ë§¤ìˆ˜ / ì €ì  ë§¤ë„
```

### 2.2 ì½”ë“œ êµ¬í˜„

```python
# brain/micro_optimizer.py (ê³„ì†)

def check_time_filter(self) -> Dict:
    """
    ì‹œê°„ëŒ€ë³„ ë§¤ë§¤ í•„í„°

    Returns:
        {
            'mode': 'STRICT' | 'NORMAL' | 'AGGRESSIVE',
            'score_adjustment': +10 | 0 | -5,
            'reason': '...'
        }
    """
    from datetime import time

    now = datetime.now().time()

    # ì ì‹¬ì‹œê°„ (11:30 ~ 13:00)
    if time(11, 30) <= now <= time(13, 0):
        return {
            'mode': 'STRICT',
            'score_adjustment': +10,  # ì ìˆ˜ ê¸°ì¤€ 65 â†’ 75
            'allow_new_entry': False,  # ì‹ ê·œ ì§„ì… ê¸ˆì§€
            'reason': 'ì ì‹¬ì‹œê°„ - ê°€ì§œ ì‹ í˜¸ ë‹¤ë°œ êµ¬ê°„'
        }

    # ì¥ ì´ˆë°˜ (09:00 ~ 09:30) - ë³€ë™ì„± ë†’ìŒ
    elif time(9, 0) <= now <= time(9, 30):
        return {
            'mode': 'NORMAL',
            'score_adjustment': +5,  # ì•½ê°„ ì—„ê²©
            'allow_new_entry': True,
            'reason': 'ì¥ ì´ˆë°˜ - ë³€ë™ì„± ì£¼ì˜'
        }

    # ì¢…ê°€ ì§ì „ (15:20 ~ 15:30)
    elif time(15, 20) <= now <= time(15, 30):
        return {
            'mode': 'AGGRESSIVE',
            'score_adjustment': -5,  # ì•½ê°„ ì™„í™”
            'allow_new_entry': True,
            'prefer_closing_auction': True,  # ì¢…ê°€ ë§¤ìˆ˜ ì„ í˜¸
            'reason': 'ì¢…ê°€ ì§ì „ - ë™ì‹œí˜¸ê°€ ìµœì '
        }

    # ì¼ë°˜ ì‹œê°„
    else:
        return {
            'mode': 'NORMAL',
            'score_adjustment': 0,
            'allow_new_entry': True,
            'reason': 'ì •ìƒ ê±°ë˜ ì‹œê°„'
        }
```

**âœ… ì ìš© íš¨ê³¼:**
- ì ì‹¬ì‹œê°„ ì†ì‹¤: -0.15% â†’ -0.05% (**0.10% ê°œì„ **)
- ì—°ê°„ 50íšŒ íšŒí”¼ â†’ **50,000ì› ì ˆì•½**

---

## 3. ì²´ê²°ê°•ë„ í™•ì¸

### 3.1 Volume Power (X-Score)

**ê³µì‹:**
```
ì²´ê²°ê°•ë„ = (ë§¤ìˆ˜ì²´ê²°ëŸ‰ / ì „ì²´ì²´ê²°ëŸ‰) Ã— 100

120% ì´ìƒ: ê°•í•œ ë§¤ìˆ˜ì„¸ (ì§„ì§œ ìƒìŠ¹) âœ…
100% ì „í›„: ê· í˜• (ê´€ë§)
80% ì´í•˜: ì•½í•œ ë§¤ìˆ˜ì„¸ (ê°€ì§œ ìƒìŠ¹) âš ï¸
```

### 3.2 íŒë‹¨ ê¸°ì¤€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ì²´ê²°ê°•ë„ ê¸°ë°˜ ë§¤ìˆ˜ íŒë‹¨                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  í˜„ì¬ê°€: +2% ìƒìŠ¹ ì¤‘                                         â”‚
â”‚  AI ì ìˆ˜: 70ì                                               â”‚
â”‚                                                             â”‚
â”‚  ì²´ê²°ê°•ë„: 150%                                             â”‚
â”‚  â†’ âœ… ì§„ì§œ ìƒìŠ¹! ë§¤ìˆ˜ ì§„í–‰                                   â”‚
â”‚                                                             â”‚
â”‚  ì²´ê²°ê°•ë„: 80%                                              â”‚
â”‚  â†’ âš ï¸ ê°€ì§œ ìƒìŠ¹! ë§¤ìˆ˜ ë³´ë¥˜                                   â”‚
â”‚     (ê°œë¯¸ë“¤ì´ ë¬¼ë¦¬ëŠ” ì¤‘...)                                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 ì½”ë“œ êµ¬í˜„

```python
# brain/micro_optimizer.py (ê³„ì†)

def check_volume_power(
    self,
    stock_code: str,
    min_power: float = 100.0
) -> Dict:
    """
    ì²´ê²°ê°•ë„ í™•ì¸

    Args:
        stock_code: ì¢…ëª© ì½”ë“œ
        min_power: ìµœì†Œ ì²´ê²°ê°•ë„ (ê¸°ë³¸ 100%)

    Returns:
        {
            'passed': True/False,
            'power': 120.5,
            'reason': '...'
        }
    """
    # KIS APIë¡œ ì²´ê²°ê°•ë„ ì¡°íšŒ (ì‹¤ì‹œê°„)
    try:
        data = self.kis.get_stock_conclusion(stock_code)

        # ë§¤ìˆ˜ì²´ê²°ëŸ‰ / ë§¤ë„ì²´ê²°ëŸ‰
        buy_volume = data.get('buy_conclusion_volume', 0)
        sell_volume = data.get('sell_conclusion_volume', 0)
        total_volume = buy_volume + sell_volume

        if total_volume == 0:
            return {
                'passed': False,
                'power': 0,
                'reason': 'ê±°ë˜ëŸ‰ ì—†ìŒ'
            }

        power = (buy_volume / total_volume) * 100

        if power >= min_power:
            return {
                'passed': True,
                'power': power,
                'reason': f'ì²´ê²°ê°•ë„ {power:.1f}% - ì–‘í˜¸'
            }
        else:
            return {
                'passed': False,
                'power': power,
                'reason': f'ì²´ê²°ê°•ë„ {power:.1f}% - ì•½í•¨ (ê°€ì§œ ìƒìŠ¹ ì˜ì‹¬)'
            }

    except Exception as e:
        # ì²´ê²°ê°•ë„ ì¡°íšŒ ì‹¤íŒ¨ ì‹œ í†µê³¼ (ë³´ìˆ˜ì )
        return {
            'passed': True,
            'power': None,
            'reason': f'ì²´ê²°ê°•ë„ ì¡°íšŒ ì‹¤íŒ¨: {e}'
        }
```

**âœ… ì ìš© íš¨ê³¼:**
- ê°€ì§œ ìƒìŠ¹ íšŒí”¼: 30% â†’ 10% (**20% ê°œì„ **)
- ê³ ì  ë§¤ìˆ˜ ë°©ì§€: í‰ê·  0.3% ë” ë‚®ì€ ê°€ê²©ì— ë§¤ìˆ˜
- ì—°ê°„ â†’ **300,000ì› ì ˆì•½**

---

## 4. ì¢…ê°€ ë² íŒ…

### 4.1 Closing Auction (ë™ì‹œí˜¸ê°€)

**í†µê³„:**
```
ì¥ì¤‘ ë§¤ìˆ˜: í‰ê·  ì²´ê²°ê°€ = ì¼ì¤‘ í‰ê· ê°€
ì¢…ê°€ ë§¤ìˆ˜: í‰ê·  ì²´ê²°ê°€ = ì¢…ê°€

ì°¨ì´: ì¢…ê°€ê°€ ë” ìœ ë¦¬í•œ ê²½ìš° 60%
```

**ì´ìœ :**
- ì™¸êµ­ì¸/ê¸°ê´€ì´ ì¢…ê°€ì— ë§ì¶° ë§¤ë§¤
- ì¥ì¤‘ ë…¸ì´ì¦ˆ íšŒí”¼
- ì¸ë±ìŠ¤ í€ë“œ ë¦¬ë°¸ëŸ°ì‹± íš¨ê³¼

### 4.2 ì „ëµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ì¢…ê°€ ë² íŒ… ì „ëµ                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  [Type-A ê°€ì¹˜ì£¼, Type-D ìˆ˜ê¸‰ì£¼]                             â”‚
â”‚  â†’ ìŠ¤ìœ™ ì¢…ëª© â†’ ì¢…ê°€ ë§¤ìˆ˜ âœ…                                  â”‚
â”‚                                                             â”‚
â”‚  ì „ëµ:                                                      â”‚
â”‚  1. 09:00 - AI ë¶„ì„ ì™„ë£Œ                                    â”‚
â”‚  2. 10:00 - ë§¤ìˆ˜ ì‹ í˜¸ ë°œìƒ                                  â”‚
â”‚  3. 15:20 - ë™ì‹œí˜¸ê°€ ì£¼ë¬¸ (ì¢…ê°€ë¡œ ë§¤ìˆ˜)                     â”‚
â”‚                                                             â”‚
â”‚  [Type-E ëª¨ë©˜í…€ì£¼]                                          â”‚
â”‚  â†’ ë‹¨íƒ€ ì¢…ëª© â†’ ì¥ì¤‘ ë§¤ìˆ˜ âœ…                                  â”‚
â”‚                                                             â”‚
â”‚  ì „ëµ:                                                      â”‚
â”‚  1. ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§                                         â”‚
â”‚  2. ëŒíŒŒ ì‹œ ì¦‰ì‹œ ë§¤ìˆ˜                                       â”‚
â”‚  3. ë‹¹ì¼ ìµì ˆ ë˜ëŠ” ì†ì ˆ                                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ì½”ë“œ êµ¬í˜„

```python
# brain/micro_optimizer.py (ê³„ì†)

def should_wait_for_closing(
    self,
    stock_code: str,
    strategy_type: str,
    ai_score: int
) -> bool:
    """
    ì¢…ê°€ ë§¤ìˆ˜ ëŒ€ê¸° ì—¬ë¶€

    Args:
        strategy_type: 'Type-A', 'Type-D', 'Type-E'

    Returns:
        True: ì¢…ê°€ê¹Œì§€ ëŒ€ê¸°
        False: ì¦‰ì‹œ ë§¤ìˆ˜
    """
    from datetime import time

    now = datetime.now().time()

    # ì´ë¯¸ ì¢…ê°€ ì§ì „ì´ë©´ ì¦‰ì‹œ ë§¤ìˆ˜
    if now >= time(15, 20):
        return False

    # Type-A (ê°€ì¹˜ì£¼), Type-D (ìˆ˜ê¸‰ì£¼): ì¢…ê°€ ë§¤ìˆ˜
    if strategy_type in ['Type-A', 'Type-D']:
        return True

    # Type-E (ëª¨ë©˜í…€): ì¦‰ì‹œ ë§¤ìˆ˜
    if strategy_type == 'Type-E':
        return False

    # ì´ˆê³ ë“ì : ì¦‰ì‹œ ë§¤ìˆ˜
    if ai_score >= 90:
        return False

    # ê¸°ë³¸: ì¢…ê°€ ë§¤ìˆ˜
    return True


def place_closing_auction_order(
    self,
    kis_api,
    stock_code: str,
    quantity: int
) -> Dict:
    """
    ì¢…ê°€ ë™ì‹œí˜¸ê°€ ì£¼ë¬¸

    15:20 ~ 15:30 ì‚¬ì´ì— ì£¼ë¬¸
    """
    from datetime import time

    now = datetime.now().time()

    # 15:20 ì´ì „ì´ë©´ ì˜ˆì•½
    if now < time(15, 20):
        wait_seconds = calculate_wait_time(now, time(15, 20))
        print(f"â° ì¢…ê°€ ë™ì‹œí˜¸ê°€ê¹Œì§€ {wait_seconds}ì´ˆ ëŒ€ê¸°")
        time.sleep(wait_seconds)

    # ì¢…ê°€ ì£¼ë¬¸ (í˜¸ê°€ ì¡°ê±´: ì¥ì „ ì¢…ê°€)
    return kis_api.place_order(
        stock_code=stock_code,
        quantity=quantity,
        order_type='CLOSING',  # ì¢…ê°€ ì£¼ë¬¸
        price=0,  # ì¢…ê°€ë¡œ ìë™ ì²´ê²°
        reason='ì¢…ê°€ ë² íŒ… - ê¸°ê´€ê³¼ ë™ì¼ ê°€ê²© ì§„ì…'
    )
```

**âœ… ì ìš© íš¨ê³¼:**
- í‰ê·  ì²´ê²°ê°€: ì¼ì¤‘ í‰ê·  ëŒ€ë¹„ -0.2% ìœ ë¦¬
- Type-A, Type-D ì¢…ëª© ì—°ê°„ 50íšŒ â†’ **100,000ì› ì ˆì•½**

---

## 5. í†µí•© ì ìš©

### 5.1 AutoTrader ìˆ˜ì •

```python
# brain/auto_trader.py (ìˆ˜ì • í•„ìš”)
from brain.micro_optimizer import MicroOptimizer

class AutoTrader:
    def __init__(self):
        self.micro = MicroOptimizer()  # ì¶”ê°€
        # ...

    def execute_buy_order(
        self,
        stock_code: str,
        amount: int,
        ai_score: int,
        strategy_type: str
    ):
        """
        ë§¤ìˆ˜ ì£¼ë¬¸ ì‹¤í–‰ (ë¯¸ì„¸ ìµœì í™” ì ìš©)
        """
        # 1. ì‹œê°„ëŒ€ í•„í„°
        time_filter = self.micro.check_time_filter()

        if not time_filter['allow_new_entry']:
            logger.info(f"â¸ï¸ {time_filter['reason']} - ë§¤ìˆ˜ ë³´ë¥˜")
            return None

        # ì ìˆ˜ ì¡°ì •
        adjusted_score = ai_score + time_filter['score_adjustment']

        if adjusted_score < 65:
            logger.info(f"ğŸ“Š ì¡°ì • ì ìˆ˜ {adjusted_score} < 65 - ë§¤ìˆ˜ ë³´ë¥˜")
            return None

        # 2. ì¢…ê°€ ëŒ€ê¸° ì—¬ë¶€
        if self.micro.should_wait_for_closing(stock_code, strategy_type, ai_score):
            logger.info("â° ì¢…ê°€ ë™ì‹œí˜¸ê°€ê¹Œì§€ ëŒ€ê¸°")
            return self.micro.place_closing_auction_order(
                self.kis,
                stock_code,
                calculate_quantity(amount, estimated_price)
            )

        # 3. ì²´ê²°ê°•ë„ í™•ì¸
        volume_check = self.micro.check_volume_power(stock_code)

        if not volume_check['passed']:
            logger.warning(f"âš ï¸ {volume_check['reason']} - ë§¤ìˆ˜ ë³´ë¥˜")
            return None

        # 4. í˜¸ê°€ ìµœì í™”
        orderbook = self.kis.get_orderbook(stock_code)
        order_info = self.micro.optimize_buy_price(stock_code, ai_score, orderbook)

        logger.info(f"ğŸ’¡ {order_info['reason']}")

        # 5. ì‹¤í–‰
        return self.micro.execute_with_patience(
            self.kis,
            stock_code,
            order_info
        )
```

### 5.2 ë‚´ì¼(12/09) ì ìš© ì²´í¬ë¦¬ìŠ¤íŠ¸

```
[ ] 1. í˜¸ê°€ ìŠ¤í”„ë ˆë“œ ë”°ë¨¹ê¸°
    - Maker ì£¼ë¬¸ ìš°ì„ 
    - 10ì´ˆ ëŒ€ê¸° í›„ ì •ì •

[ ] 2. ì ì‹¬ì‹œê°„ í•„í„°
    - 11:30-13:00 ì‹ ê·œ ì§„ì… ê¸ˆì§€
    - ì ìˆ˜ ê¸°ì¤€ +10ì 

[ ] 3. ì²´ê²°ê°•ë„ í™•ì¸
    - 100% ë¯¸ë§Œ ì‹œ ë§¤ìˆ˜ ë³´ë¥˜
    - ê°€ì§œ ìƒìŠ¹ íšŒí”¼

[ ] 4. ì¢…ê°€ ë² íŒ…
    - Type-A, Type-D: 15:20 ì¢…ê°€ ì£¼ë¬¸
    - Type-E: ì¦‰ì‹œ ë§¤ìˆ˜
```

---

## ğŸ“Š í†µí•© íš¨ê³¼ ì‹œë®¬ë ˆì´ì…˜

### Case Study: ì‚¼ì„±ì „ì ë§¤ìˆ˜

#### ê¸°ì¡´ ë°©ì‹
```
10:30 ì‹œì¥ê°€ ë§¤ìˆ˜
ì²´ê²°ê°€: 109,600ì›
ìˆ˜ëŸ‰: 45ì£¼
ê¸ˆì•¡: 4,932,000ì›
```

#### ë¯¸ì„¸ ìµœì í™” ì ìš©
```
[1] í˜¸ê°€ ìµœì í™”
    ë§¤ìˆ˜ 1í˜¸ê°€: 109,500ì› (ì§€ì •ê°€)
    10ì´ˆ ëŒ€ê¸° â†’ ì²´ê²° ì„±ê³µ!
    ì ˆì•½: 100ì› Ã— 45ì£¼ = 4,500ì›

[2] ì²´ê²°ê°•ë„ í™•ì¸
    ì²´ê²°ê°•ë„: 85% (ì•½í•¨)
    â†’ ë§¤ìˆ˜ ë³´ë¥˜, 10ë¶„ í›„ ì¬ì²´í¬
    ì¬ì²´í¬: 115% (ê°•í•¨) â†’ ë§¤ìˆ˜ ì§„í–‰
    ì²´ê²°ê°€: 109,400ì› (ì¡°ì • í›„)
    ì¶”ê°€ ì ˆì•½: 200ì› Ã— 45ì£¼ = 9,000ì›

[3] ì¢…ê°€ ë² íŒ… (Type-A ì¢…ëª©)
    15:20 ì¢…ê°€ ì£¼ë¬¸
    ì¢…ê°€: 109,200ì›
    ì¶”ê°€ ì ˆì•½: 400ì› Ã— 45ì£¼ = 18,000ì›

ì´ ì ˆì•½: 31,500ì› (0.64%)
```

**ì—°ê°„ íš¨ê³¼:**
- 100íšŒ ê±°ë˜ Ã— í‰ê·  0.5% ì ˆì•½
- **ì´ 1,500,000ì› ì ˆì•½!** ğŸ¯

---

## ğŸ¯ AEGIS ë¯¸ì„¸ ìµœì í™” ì¢…í•©

### ì ìš© ê¸°ë²• ì²´í¬

| ê¸°ë²• | ì ˆì•½ íš¨ê³¼ | ì ìš© ë‚œì´ë„ | ìš°ì„ ìˆœìœ„ | ìƒíƒœ |
|-----|----------|-----------|---------|------|
| **í˜¸ê°€ ìŠ¤í”„ë ˆë“œ** | 0.12% / ê±´ | ì‰¬ì›€ | ğŸ”¥ ìµœê³  | êµ¬í˜„ í•„ìš” |
| **ì ì‹¬ì‹œê°„ í•„í„°** | 0.10% / ê±´ | ì‰¬ì›€ | ğŸ”¥ ìµœê³  | êµ¬í˜„ í•„ìš” |
| **ì²´ê²°ê°•ë„** | 0.30% / ê±´ | ë³´í†µ | ğŸ”¥ ìµœê³  | êµ¬í˜„ í•„ìš” |
| **ì¢…ê°€ ë² íŒ…** | 0.20% / ê±´ | ì‰¬ì›€ | ë†’ìŒ | êµ¬í˜„ í•„ìš” |

**ì´ ì˜ˆìƒ íš¨ê³¼: 0.72% / ê±´**

### ì—°ê°„ ì‹œë®¬ë ˆì´ì…˜

```
ì—°ê°„ ê±°ë˜: 200íšŒ
í‰ê·  íˆ¬ìì•¡: 500ë§Œì› / ê±´

ê¸°ì¡´ ìˆ˜ìµë¥ : 55% ìŠ¹ë¥ , í‰ê·  +3.5%
ìµœì í™” ì ìš©: 55% ìŠ¹ë¥ , í‰ê·  +4.22% (+0.72%)

ì°¨ì´: +0.72% Ã— 200íšŒ Ã— 500ë§Œì›
    = ì•½ 720ë§Œì› ì¶”ê°€ ìˆ˜ìµ! ğŸš€
```

---

## ğŸ“ êµ¬í˜„ íŒŒì¼

### ì‹ ê·œ ìƒì„± í•„ìš”

```python
# brain/micro_optimizer.py (ì´ ë¬¸ì„œ ê¸°ë°˜)
class MicroOptimizer:
    def optimize_buy_price()
    def check_time_filter()
    def check_volume_power()
    def should_wait_for_closing()
    def place_closing_auction_order()
    def execute_with_patience()
```

### ìˆ˜ì • í•„ìš”

```python
# brain/auto_trader.py
- execute_buy_order() ìˆ˜ì •
- MicroOptimizer í†µí•©
```

---

## ğŸš€ ë‚´ì¼(12/09) ì¦‰ì‹œ ì ìš©

### Phase 1: ê°„ë‹¨í•œ ê²ƒë¶€í„° (ë‚´ì¼ ì•„ì¹¨)

```python
# ì ì‹¬ì‹œê°„ í•„í„°ë§Œ ìš°ì„  ì ìš©
def should_trade_now():
    now = datetime.now().time()
    if time(11, 30) <= now <= time(13, 0):
        return False  # ì ì‹¬ì‹œê°„ ê±°ë˜ ê¸ˆì§€
    return True
```

### Phase 2: 1ì£¼ì¼ ë‚´

- [ ] í˜¸ê°€ ìŠ¤í”„ë ˆë“œ ìµœì í™”
- [ ] ì²´ê²°ê°•ë„ í•„í„°
- [ ] ì¢…ê°€ ë² íŒ…

---

## ğŸ“š ì°¸ê³ 

### ê´€ë ¨ ë¬¸ì„œ
- `TRADING_TECHNIQUES.md`: ê³ ê¸‰ ë§¤ë§¤ ê¸°ë²•
- `PYRAMIDING_STRATEGY.md`: í”¼ë¼ë¯¸ë”© ì „ëµ
- `BRAIN_SIMPLE.md`: Brain ì˜ì‚¬ê²°ì •

### ê´€ë ¨ ì½”ë“œ
- `brain/auto_trader.py`: ë§¤ë§¤ ì‹¤í–‰
- `fetchers/kis.py`: KIS API
- `brain/micro_optimizer.py`: ë¯¸ì„¸ ìµœì í™” (êµ¬í˜„ í•„ìš”)

---

## ğŸ’¡ í•µì‹¬ êµí›ˆ

```
"ê±°ì°½í•œ AIë³´ë‹¤, ì£¼ë¬¸ ë„£ëŠ” ê·¸ ìˆœê°„ì˜ ë””í…Œì¼ì´
 ë§ˆì§€ë§‰ ì†Œìˆ˜ì ì„ ê²°ì •í•œë‹¤"

- 10ì› ë” ì‹¸ê²Œ ì‚¬ê¸°
- 10ì› ë” ë¹„ì‹¸ê²Œ íŒ”ê¸°
- ê°€ì§œ ì‹ í˜¸ ê±°ë¥´ê¸°
- ê¸°ê´€ê³¼ ê°™ì€ íƒ€ì´ë°

â†’ ì´ê²ƒì´ 0.001%ë¥¼ ë§Œë“ ë‹¤
```

---

**ì‘ì„±ì¼**: 2025-12-08
**ì‘ì„±ì**: wonny
**ë²„ì „**: 1.0.0
**ëª©í‘œ**: ì—°ê°„ +7.2% ìˆ˜ìµë¥  ê°œì„ 
